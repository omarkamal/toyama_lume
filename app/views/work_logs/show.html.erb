<% content_for :title, "Work Log - #{@work_log.punch_in.strftime("%B %d, %Y")}" %>

<div class="min-h-screen bg-carbon-light">
  <!-- Header -->
  <div class="bg-white border-b border-cloudy px-4 py-4 sm:px-6">
    <div class="flex items-center gap-4">
      <%= link_to work_logs_path, class: "inline-flex items-center gap-2 text-carbon-heavy/60 hover:text-navy transition-colors" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        <span class="text-sm font-body font-normal">Back to Work Logs</span>
      <% end %>

      <div class="flex-1">
        <h1 class="text-xl font-heading font-medium text-navy">Work Session Details</h1>
        <p class="text-carbon-heavy/60 text-sm font-body font-light">
          <%= @work_log.punch_in.strftime("%A, %B %d, %Y") %>
        </p>
      </div>

      <% if @work_log.punch_out.blank? %>
        <div class="bg-lime/20 border border-lime/30 px-3 py-1.5 rounded-lg inline-flex items-center gap-1.5">
          <div class="w-2 h-2 bg-lime rounded-full animate-pulse"></div>
          <span class="text-lime text-xs font-body font-normal">Active</span>
        </div>
      <% else %>
        <div class="bg-teal/10 border border-teal/20 px-3 py-1.5 rounded-lg">
          <span class="text-teal text-xs font-body font-normal">Completed</span>
        </div>
      <% end %>
    </div>
  </div>

  <div class="max-w-4xl mx-auto px-4 py-6">
    <!-- Session Overview Card -->
    <div class="bg-white rounded-xl border border-cloudy shadow-sm p-6 mb-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-lg font-heading font-medium text-navy">Session Overview</h2>
        <div class="flex items-center gap-4">
          <!-- Mood Display -->
          <% if @work_log.mood.present? %>
            <div class="flex items-center gap-2">
              <span class="text-sm text-carbon-heavy/60">Mood:</span>
              <span class="text-2xl">
                <%= case @work_log.mood
                    when 'happy' then 'ðŸ˜Š'
                    when 'neutral' then 'ðŸ˜'
                    when 'sad' then 'ðŸ˜ž'
                    else 'ðŸ˜'
                    end %>
              </span>
            </div>
          <% end %>

          <!-- Duration -->
          <% if @work_log.punch_out.present? %>
            <div class="text-right">
              <div class="text-2xl font-heading font-medium text-teal"><%= @work_log.duration_hours %><span class="text-lg font-normal">h</span></div>
              <div class="text-xs text-carbon-heavy/60">Total Duration</div>
            </div>
          <% else %>
            <div class="text-right">
              <div class="text-2xl font-heading font-medium text-lime"><%= distance_of_time_in_words(@work_log.punch_in, Time.current) %></div>
              <div class="text-xs text-carbon-heavy/60">So far</div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Time Details -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-teal/10 rounded-lg flex items-center justify-center flex-shrink-0">
            <svg class="w-6 h-6 text-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
            </svg>
          </div>
          <div>
            <div class="font-body font-normal text-navy">Punch In</div>
            <div class="text-sm text-carbon-heavy/60">
              <%= @work_log.punch_in.strftime("%I:%M %p") %>
            </div>
          </div>
        </div>

        <% if @work_log.punch_out.present? %>
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-red/10 rounded-lg flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
              </svg>
            </div>
            <div>
              <div class="font-body font-normal text-navy">Punch Out</div>
              <div class="text-sm text-carbon-heavy/60">
                <%= @work_log.punch_out.strftime("%I:%M %p") %>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Location Info -->
      <% if @work_log.location_lat.present? && @work_log.location_lng.present? %>
        <div class="mt-6 pt-6 border-t border-cloudy">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue/10 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </div>
            <div>
              <div class="font-body font-normal text-navy text-sm">Location</div>
              <div class="text-xs text-carbon-heavy/60">
                Lat: <%= @work_log.location_lat.round(6) %>, Lng: <%= @work_log.location_lng.round(6) %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Tasks Section -->
    <% if @work_log.work_log_tasks.any? %>
      <div class="bg-white rounded-xl border border-cloudy shadow-sm">
        <div class="p-6 border-b border-cloudy">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-heading font-medium text-navy">Tasks</h2>
            <span class="text-sm text-carbon-heavy/60">
              <%= @work_log.work_log_tasks.count %> total
            </span>
          </div>
        </div>

        <div class="divide-y divide-cloudy">
          <% @work_log.work_log_tasks.includes(:task).each do |work_log_task| %>
            <div class="p-6">
              <div class="flex items-start gap-4">
                <!-- Status Indicator -->
                <div class="flex-shrink-0 mt-1">
                  <% if work_log_task.completed? %>
                    <div class="w-6 h-6 bg-lime rounded-full flex items-center justify-center">
                      <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                      </svg>
                    </div>
                  <% elsif work_log_task.in_progress? %>
                    <div class="w-6 h-6 bg-teal rounded-full flex items-center justify-center">
                      <div class="w-2 h-2 bg-white rounded-full"></div>
                    </div>
                  <% else %>
                    <div class="w-6 h-6 border-2 border-cloudy rounded-full"></div>
                  <% end %>
                </div>

                <!-- Task Details -->
                <div class="flex-1 min-w-0">
                  <h3 class="text-base font-body font-normal text-navy mb-2"><%= work_log_task.task.title %></h3>

                  <div class="flex items-center gap-3 mb-3">
                    <span class="inline-flex items-center px-3 py-1 rounded-md text-sm font-body font-light
                      <%= case work_log_task.status
                          when 'planned' then 'bg-cloudy text-carbon-heavy'
                          when 'in_progress' then 'bg-teal/10 text-teal'
                          when 'completed' then 'bg-lime/10 text-lime'
                          else 'bg-gray-100 text-gray-800'
                          end %>">
                      <%= work_log_task.status.humanize %>
                    </span>

                    <% if work_log_task.task.priority.present? %>
                      <span class="inline-flex items-center px-3 py-1 rounded-md text-sm font-body font-light
                        <%= case work_log_task.task.priority
                            when 'high' then 'bg-red-100 text-red-800'
                            when 'medium' then 'bg-yellow-100 text-yellow-800'
                            when 'low' then 'bg-lime/10 text-lime'
                            else 'bg-gray-100 text-gray-800'
                            end %>">
                        <%= work_log_task.task.priority.titleize %>
                      </span>
                    <% end %>

                    <% if work_log_task.task.category.present? %>
                      <span class="inline-flex items-center px-3 py-1 rounded-md text-sm font-body font-light bg-navy/10 text-navy">
                        <%= work_log_task.task.category %>
                      </span>
                    <% end %>
                  </div>

                  <!-- Duration Display -->
                  <% if work_log_task.duration_minutes.present? %>
                    <div class="flex items-center gap-2 text-sm text-carbon-heavy/60">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <span><%= work_log_task.duration_minutes %> minutes</span>
                    </div>
                  <% end %>

                  <!-- Notes -->
                  <% if work_log_task.notes.present? %>
                    <div class="mt-3 p-3 bg-carbon-light rounded-lg">
                      <p class="text-sm text-carbon-heavy/70"><%= work_log_task.notes %></p>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <!-- Task Summary -->
        <div class="p-6 border-t border-cloudy bg-carbon-light">
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
            <div>
              <div class="text-xl font-heading font-medium text-navy">
                <%= @work_log.work_log_tasks.completed.count %>
              </div>
              <div class="text-xs text-carbon-heavy/60">Completed</div>
            </div>
            <div>
              <div class="text-xl font-heading font-medium text-teal">
                <%= @work_log.work_log_tasks.in_progress.count %>
              </div>
              <div class="text-xs text-carbon-heavy/60">In Progress</div>
            </div>
            <div>
              <div class="text-xl font-heading font-medium text-cloudy">
                <%= @work_log.work_log_tasks.planned.count %>
              </div>
              <div class="text-xs text-carbon-heavy/60">Planned</div>
            </div>
            <div>
              <div class="text-xl font-heading font-medium text-orange">
                <%= @work_log.work_log_tasks.sum(&:duration_minutes) %>m
              </div>
              <div class="text-xs text-carbon-heavy/60">Tracked</div>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <!-- No Tasks -->
      <div class="bg-white rounded-xl border border-cloudy shadow-sm p-12 text-center">
        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
        </div>
        <h3 class="text-lg font-heading font-medium text-navy mb-2">No Tasks Added</h3>
        <p class="text-sm text-carbon-heavy/60">This work session doesn't have any tasks associated with it.</p>
      </div>
    <% end %>
  </div>
</div>
